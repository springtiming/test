# TradeMind UI 改造方案（历史决策展示与复盘分析）

本文档面向 `trademind-ui`，目标是把当前“决策评审 + 社区榜单”的 UI，升级为“可检索的历史决策库 + 可审计的决策详情 + 可聚合的复盘分析”，并保持产品为**独立前端**，统一调用 `research api`。

## 1. 目标与原则

### 目标
- 支持历史决策的**检索、筛选、排序、对比**。
- 决策详情可读（叙事）且可审计（版本/变更/执行记录）。
- 支持按策略/标签/作者/时间等维度的聚合复盘（命中率、赔率、回撤、延迟等）。
- 保留现有“评审/点赞/研究员体系/管理员审核”的社区能力，但把它们挂靠到“决策对象”上。

### 原则
- **不推倒重写**：在现有 React + TS + Router + Tailwind 基础上增量演进。
- **API 驱动**：页面不直接依赖 mock；mock 仅用于开发回退或 Storybook/fixture（如未来引入）。
- **领域分层**：页面组件与 API/类型解耦，便于替换/扩展后端字段。

## 2. 信息架构（导航与路由）

建议新增/调整导航：
- 决策库：`/decisions`（新增）
- 决策详情：`/decisions/:id`（新增，支持深链分享）
- 复盘分析：`/analytics`（新增）
- 评审广场：`/`（保留现有 DecisionReview，可后续改名为 “广场/推荐”）
- 研究员榜单：`/ranking`（保留，后续改为 API 驱动）
- 管理：`/admin`（保留）
- 设置：`/settings`（保留）

## 3. 页面级改造说明

### 3.1 决策库（`/decisions`）
**定位**：历史决策入口与工作台。

**布局建议**
- 顶部：搜索 + 快速筛选条（Symbol、方向、状态、研究员、日期范围、标签、置信度/风险等级等）。
- 主区：列表（卡片或表格均可），支持分页/无限滚动。
- 右侧可选：保存的筛选视图（Saved Views）/最近浏览。

**列表单元（卡片/行）应露出关键字段**
- `symbol`、`direction`、`status`
- `entryTime`（或 createdAt）、研究员（researcher）
- `pnl`（若已平仓）、`score`、`reviewCount`
- 风控提示（如 `stopLoss` / `takeProfit` 存在则显示小标签）

**交互**
- 点击进入详情：`/decisions/:id`
- 支持多选对比（可先做 V2）：选中两条决策进入对比弹窗/对比页

### 3.2 决策详情（`/decisions/:id`）
**定位**：叙事 + 证据 + 执行/审计 + 结果，全部围绕“决策对象”组织。

**模块结构**
1) 决策摘要条（固定在上方）
- 一句话结论（方向 + 关键价格区间）
- 触发条件、失效条件（如果后端提供）
- 风险预算/止损止盈（`stopLoss`/`takeProfit`）
- 状态（open/closed/cancelled）与结果（若 closed：pnl、持有时长等）

2) 图表区（复用现有图表容器与 `lightweight-charts`）
- K 线 + 指标（如果现有 `components/chart/*` 已支持）
- 叠加决策标记（入场/出场/止损/止盈）
- 支持切换周期（目前 mock 有 `3m`/`4h`，建议保持）

3) 依据/证据区（V1 可先最简）
- 展示 `entryReason`、`exitReason`
- 若 research api 支持“引用证据”，建议以列表形式呈现（标题 + 来源 + 跳转锚点）

4) 评审区（复用现有 Review 体系）
- 热门/最新排序
- 点赞/删除权限逻辑沿用现有角色模型

5) 审计/时间线（V2）
- 版本变更（谁在什么时间更新了哪些字段）
- 执行记录（真实成交/偏差等，若后端提供）

### 3.3 复盘分析（`/analytics`）
**定位**：从单条复盘升级为群体复盘。

**V1（先做能落地的）**
- 过滤条件：时间范围、symbol、研究员、方向、状态、标签/策略（若有）
- 汇总卡片：总交易数、胜率、平均盈亏、最大回撤、夏普、总盈亏（对应 `DecisionStats`）
- 简单图表：盈亏分布、胜负随时间、回撤曲线（可复用 `components/chart/EquityCurve` 思路）

**V2**
- 策略/标签维度对比
- 决策延迟（发现→下结论→执行）与质量相关性

## 4. 组件与代码结构建议（面向可维护性）

建议在 `src/` 下引入领域目录（不强制一次性搬完，允许渐进迁移）：
- `src/features/decisions/*`：列表、详情、筛选、类型适配
- `src/features/reviews/*`：评审列表、提交、点赞（与决策详情绑定）
- `src/services/researchApi/*`：统一请求封装与 endpoint 调用
- `src/shared/*`：通用组件（空态/错误态/分页/骨架屏）

现有组件的调整方向：
- `components/DecisionCard.tsx`：当前信息量过少（只显示 symbol），建议升级为“决策摘要卡片”，或新增 `DecisionListItem`，避免破坏现有首页布局。
- `pages/DecisionReview.tsx`：长期建议从“左侧决策列表”改为“推荐/热门评审流”，而“历史决策检索”交给 `/decisions`。

## 5. 状态与体验规范（必须统一）

每个页面至少具备：
- 加载态：Skeleton（列表/详情/图表分别设计）
- 空态：可行动（引导清筛选/回到默认）
- 错误态：展示 `requestId`（便于后端排查），提供重试

## 6. 里程碑（建议）

### Phase 1（可上线最小闭环）
- `/decisions` + `/decisions/:id` 路由与基础 UI
- research api：决策列表/详情接入（替换 mock）
- 评审列表/提交接入（如后端已具备）

### Phase 2（复盘与增长）
- `/analytics` 聚合统计接入
- 决策详情审计/时间线（若后端支持）

### Phase 3（质量与效率）
- 保存筛选视图、对比视图、导出（Markdown/PDF）

